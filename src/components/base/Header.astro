---
import ThemeSwitcher from "@components/base/ThemeSwitcher.astro";
import { IoSearch } from "react-icons/io5";

const { pathname } = Astro.url;
const baseUrl = import.meta.env.BASE_URL;

const stickyHeader = true;

const menu = [
  {
    name: "Home",
    url: "/",
  },
  {
    name: "About",
    url: "/about",
  },
  {
    name: "Docs",
    url: "/docs",
    dropdown: [
      { name: "Characters", url: "/docs/characters" },
      { name: "The Arcane", url: "/docs/the-arcane" },
      { name: "Tutorials", url: "/docs/tutorials" },
    ]
  },
  {
    name: "Blog",
    url: "/blog",
    dropdown: [
      { name: "Categories", url: "/blog/categories" },
      { name: "Tags", url: "/blog/tags" },
    ]
  },
  {
    name: "Content",
    url: "#",
    dropdown: [
      { name: "Recipes", url: "/recipes" },
      { name: "Poetry", url: "/poetry" },
      { name: "Index Cards", url: "/index-cards" },
    ]
  },
  {
    name: "Authors",
    url: "/authors",
  },
  {
    name: "Portfolio",
    url: "/portfolio",
  },
];
---

<header
  transition:persist
  class={`container glass py-2 z-30 mb-4 lg:mt-4 lg:rounded-lg ${stickyHeader && "sticky top-0"}`}
>
  <nav class="relative flex flex-wrap items-center justify-between">
    <!-- Left icon slot -->
    <div class="order-0 mr-4 inline-block text-xl text-txt-p dark:text-darkmode-txt-p">
      <img src="/src/assets/astrogon-star.svg" alt="Astrogon Star" class="h-8 w-8" />
    </div>
    <!-- navbar toggler -->
    <input id="nav-toggle" type="checkbox" class="hidden" />
    <label
      for="nav-toggle"
      class="order-0 cursor-pointer flex items-center md:hidden text-txt-p dark:text-darkmode-txt-p lg:order-1"
    >
      <svg id="show-button" class="h-6 fill-current block" viewBox="0 0 20 20">
        <title>Menu Open</title>
        <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path>
      </svg>
      <svg id="hide-button" class="h-6 fill-current hidden" viewBox="0 0 20 20">
        <title>Menu Close</title>
        <polygon
          points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2"
          transform="rotate(45 10 10)"></polygon>
      </svg>
    </label>
    <!-- /navbar toggler -->
    <ul
      id="nav-menu"
      class="text-center lg:text-left order-3 hidden w-full pb-6 md:order-1 md:flex md:w-auto md:space-x-2 md:pb-0 lg:space-x-4"
    >
      {
        menu.map((item) => {
          const fullUrl = `${baseUrl}${item.url}`.replace(/\/+/g, '/');
          const hasDropdown = item.dropdown && item.dropdown.length > 0;
          return (
            <li class={`relative ${hasDropdown ? 'group' : ''}`}>
              <a
                href={hasDropdown ? '#' : fullUrl}
                class={`block p-2 font-secondary font-semibold text-txt-p transition dark:text-darkmode-txt-p lg:px-2 lg:py-3 ${
                  (pathname === `${item.url}/` || pathname === item.url) &&
                  "active"
                } ${hasDropdown ? 'cursor-pointer' : ''}`}
                onclick={hasDropdown ? 'event.preventDefault();' : ''}
              >
                {item.name}
                {hasDropdown && (
                  <svg class="inline-block w-4 h-4 ml-1 transition-transform group-hover:rotate-180" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                  </svg>
                )}
              </a>
              {hasDropdown && (
                <ul class="absolute left-0 mt-2 w-48 bg-bg-p dark:bg-darkmode-bg-p border border-border dark:border-darkmode-border rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                  {item.dropdown.map((dropdownItem) => {
                    const dropdownFullUrl = `${baseUrl}${dropdownItem.url}`.replace(/\/+/g, '/');
                    return (
                      <li>
                        <a
                          href={dropdownFullUrl}
                          class="block px-4 py-2 text-txt-p dark:text-darkmode-txt-p hover:bg-border dark:hover:bg-darkmode-border transition-colors first:rounded-t-lg last:rounded-b-lg"
                        >
                          {dropdownItem.name}
                        </a>
                      </li>
                    );
                  })}
                </ul>
              )}
            </li>
          );
        })
      }
    </ul>
    <div class="order-1 ml-auto flex items-center md:order-2 lg:ml-0">
      <a
        class="mr-4 inline-block border-border text-xl text-txt-p dark:border-darkmode-border dark:text-darkmode-txt-p"
        href={`${baseUrl}/search`}
        aria-label="search"
      >
        <IoSearch />
      </a>
      <ThemeSwitcher />
    </div>
  </nav>
</header>
